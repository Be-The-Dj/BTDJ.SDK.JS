!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.BTDJ=e()}}(function(){return function e(t,n,o){function r(s,u){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){var n=t[s][1][e];return r(n?n:e)},f,f.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){var o=e("./api/oauth2"),r=e("./vars/offsetObject"),i=e("./vars/user"),s=e("./vars/track"),u=e("./vars/location"),a=e("./logger"),c=e("./utils");const f="https://api.btdj.de/",h="https://dev-api.btdj.de/",d="api/User",l="api/Liveplaylist",p="api/Location",g="api/Checkin",v="/Get",m=15;n.OAuth2=o,n.getApiUrl=function(){return BTDJ.isDevMode()?h:f},n.getCurrentUser=function(){var e=this;return new Promise(function(t,n){var r={headers:o.getAuthorzationHeader()};c.XHR(e.getApiUrl()+d+v,r).then(function(e){t(new i(e))},n)})},n.getCurrentLocation=function(){var e=this;return new Promise(function(t,n){var r={headers:o.getAuthorzationHeader()};c.XHR(e.getApiUrl()+p+"/Checkin",r).then(function(e){t(new u(e.Location))},n)})},n.getLocation=function(){var e=this;return new Promise(function(t,n){var r={headers:o.getAuthorzationHeader()};c.XHR(e.getApiUrl()+p+v,r).then(function(e){t(new u(e))},n)})},n.getLocationWithGPS=function(e,t){var n=this;return new Promise(function(r,i){if(!navigator.geolocation)return void i(new Error("Geolocation is not supported by this browser."));var s={enableHighAccuracy:!0,maximumAge:6e4},f=!1,h=function(e){if(i(e),f=!0,c.isDefined(e.code))switch(e.code){case e.PERMISSION_DENIED:a.error("Geolocation: User denied the request for Geolocation.");break;case e.POSITION_UNAVAILABLE:a.error("Geolocation: Location information is unavailable.");break;case e.TIMEOUT:a.error("Geolocation: The request to get user location timed out.");break;default:a.error("An unknown error occurred.")}};window.setTimeout(function(){f||(a.log("Geolocation: Time out."),h(new Error("Geo Location timed out.")))},3e4),navigator.geolocation.getCurrentPosition(function(s){f=!0;var a={headers:o.getAuthorzationHeader(),params:{GPS_Lat:s.coords.latitude,GPS_Lon:s.coords.longitude,Radius:50,OffsetIndex:c.isDefined(e)?e:0,OffsetCount:c.isDefined(t)&&0!=t?t:m}};c.XHR(n.getApiUrl()+p+v,a).then(function(e){r(new u(e))},i)},h,s)})},n.getLiveplaylist=function(e,t){var n=this;return new Promise(function(i,u){var a={headers:o.getAuthorzationHeader(),params:{OffsetIndex:c.isDefined(e)?e:0,OffsetCount:c.isDefined(t)&&0!=t?t:m}};c.XHR(n.getApiUrl()+l+v,a).then(function(e){i(new r(e,function(e){var t=[];return c.forEach(e,function(e,n){t.push(new s(e))}),t}))},u)})},n.voteForTrack=function(e,t,n){var r,i=this;return r=c.isString(e)?e:e.getUID(),new Promise(function(e,t){var n={method:"PUT",headers:o.getAuthorzationHeader()};c.XHR(i.getApiUrl()+l+"/Vote_Track/"+r,n).then(e,t)})},n.addTrackToLiveplaylist=function(e,t,n){var r,i=this;return r=c.isString(e)?e:e.getUID(),new Promise(function(e,t){var n={method:"POST",headers:o.getAuthorzationHeader()};c.XHR(i.getApiUrl()+l+"/Add_Track/"+r,n).then(e,t)})},n.searchTrack=function(e,t,n){var i=this;return new Promise(function(u,a){var f={headers:o.getAuthorzationHeader(),params:{Term:e,OffsetIndex:c.isDefined(t)?t:0,OffsetCount:c.isDefined(n)&&0!=n?n:m}};c.XHR(i.getApiUrl()+l+"/Search",f).then(function(e){u(new r(e,function(e){var t=[];return c.forEach(e,function(e,n){t.push(new s(e))}),t}))},a)})},n.checkIn=function(e){var t=this;return new Promise(function(n,r){var i={method:"POST",headers:o.getAuthorzationHeader(),params:{Code:e}};c.XHR(t.getApiUrl()+g+"/Create",i).then(function(e){n(new u(e.Location))},r)})}},{"./api/oauth2":3,"./logger":5,"./utils":6,"./vars/location":9,"./vars/offsetObject":10,"./vars/track":11,"./vars/user":12}],2:[function(e,t,n){function o(){return BTDJ.isDevMode()?c:a}function r(e){s.isUndefined(e.login)&&(e.login=f),this.client=BTDJ.API.OAuth2.getClient(),this.redirect=e.login.redirect,this.overStorage=e.login.overStorage,this.scopes=e.login.scopes,this.timeOut=e.login.timeOut,this.authUrl=i(this)}function i(e){return o()+"?scope="+e.scopes+"&client_id="+e.client.clientKey+"&response_type=code&redirect_uri="+(e.redirect||window.location.protocol+"//"+window.location.hostname)}var s=e("../utils"),u=e("../logger");const a="https://auth.cuco.lol/BTDJ/OAuth2/Authorize",c="https://dev.auth.cuco.lol/BTDJ/OAuth2/Authorize",f={overStorage:!0,timeOut:500,scopes:"user_private"};r.prototype.run=function(){var e=this,t=s.readSessionStorage("btdj.access.code"),n=!1,o=s.isDefined(s.urlParameterByName("code"));if(n||o){u.log("Get token.");var r;return o?r=s.urlParameterByName("code"):n&&(r=t),new Promise(function(e,t){s.isDefined(r)?(s.writeSessionStorage("btdj.access.code",r),e(r)):t()})}u.log("Code not found."),setTimeout(function(){window.location.href=e.authUrl},e.timeOut)},t.exports=r},{"../logger":5,"../utils":6}],3:[function(e,t,n){function o(){return BTDJ.isDevMode()?f:c}function r(e){u.isUndefined(e)&&a.error("the code is not defined.");var t={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{grant_type:"authorization_code",code:e,client_id:h.clientKey,client_secret:h.clientSecret,state:Math.abs(Math.random().toString().split("").reduce(function(e,t){return(e<<5)-e+t})).toString(36).substr(0,11),redirect_uri:window.location.protocol+"//"+window.location.hostname},transformRequest:function(e){var t=[];for(p in e)t.push(encodeURIComponent(p)+"="+encodeURIComponent(e[p]));return t.join("&")}};return new Promise(function(e,n){u.XHR(o(),t).then(function(t){u.writeSessionStorage("btdj.access.token",JSON.stringify(t)),d=new i(t),e()},n)})}function i(e){this.accessToken=e.access_token,this.refreshToken=e.refresh_token,this.tokenType=e.token_type}var s=e("./login"),u=e("../utils"),a=e("../logger");const c="https://auth.cuco.lol/BTDJ/OAuth2/Token",f="https://dev.auth.cuco.lol/BTDJ/OAuth2/Token";var h,d;n.refreshToken=function(){d.isDefined()||a.error("The data is undefined.");var e={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{grant_type:"refresh_token",refresh_token:d.getRefreshToken(),client_id:h.clientKey,client_secret:h.clientSecret},transformRequest:function(e){var t=[];for(p in e)t.push(encodeURIComponent(p)+"="+encodeURIComponent(e[p]));return t.join("&")}};return new Promise(function(t,n){u.XHR(o(),e).then(function(e){u.writeSessionStorage("btdj.access.token",JSON.stringify(e)),d=new i(e),t()},function(e){a.log("Error on get token: "+e),n(e)})})},n.setClient=function(e,t){h={clientKey:e,clientSecret:t},a.log("Client was set.")},n.getClient=function(){return h},n.getAccessToken=function(){return u.isDefined(d)?d.getToken():null},n.getAuthorzationHeader=function(){return{Authorization:d.getType()+" "+d.getToken()}},n.isAuthenticated=function(){return u.isDefined(d)},n.clear=function(){u.removeSessionStorage("btdj.access.token")},n.createLogin=function(e){var t={client:h,login:u.isDefined(e)?e:{scopes:"user_private"}};return new Promise(function(e,n){var o=u.readSessionStorage("btdj.access.token");if(u.isUndefined(o)||null==o){var c=new s(t);c.run().then(function(t){a.log("Login was successfully. Code was received."),r(t).then(function(){u.removeSessionStorage("btdj.access.code"),e()},n)},function(e){a.log("Login failed. "+e),n()}),a.log("Login was created.")}else d=new i(JSON.parse(o)),e(),a.log("Token was found.")})},i.prototype.getToken=function(){return this.accessToken},i.prototype.getRefreshToken=function(){return this.refreshToken},i.prototype.getType=function(){return this.tokenType},i.prototype.isDefined=function(){return u.isDefined(this.accessToken)&u.isDefined(this.refreshToken)}},{"../logger":5,"../utils":6,"./login":2}],4:[function(e,t,n){var o=e("./api");e("./api/login"),e("./utils");const r={devMode:!1,autoLogin:!1,defaultCoverUrl:null,defaultAvatarUrl:null};n.API=o,n.init=function(e){return this.options=e||r,o.OAuth2.setClient(e.clientKey,e.clientSecret),e.autoLogin?o.OAuth2.createLogin(e.login):new Promise(function(e,t){e()})},n.isDevMode=function(){return this.options.devMode},n.getDefaultCoverUrl=function(){return this.options.defaultCoverUrl},n.getDefaultAvatarUrl=function(){return this.options.defaultAvatarUrl},n.OffsetObject=e("./vars/offsetObject"),n.Track=e("./vars/track")},{"./api":1,"./api/login":2,"./utils":6,"./vars/offsetObject":10,"./vars/track":11}],5:[function(e,t,n){n.error=function(e){throw new Error(e)},n.log=function(e){BTDJ.isDevMode()&&console.log("[ "+(new Date).toUTCString()+" ] "+e)}},{}],6:[function(e,t,n){var o;n.isDefined=function(e){return"undefined"!=typeof e},n.isUndefined=function(e){return"undefined"==typeof e},n.isString=function(e){return"string"==typeof e},n.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.XHR=function(e,t){var n=this;return n.isUndefined(t)&&(t={}),new Promise(function(o,r){if(n.isDefined(t.params)){var i="";for(item in t.params)t.params.hasOwnProperty(item)&&n.isDefined(item)&&(""!=i&&(i+="&"),i+=item+"="+t.params[item]);-1==e.indexOf("?")&&(i="?"+i),e+=i}var s=new XMLHttpRequest;if(s.open(t.method||"GET",e),n.isDefined(t.headers))for(item in t.headers)t.headers.hasOwnProperty(item)&&n.isDefined(item)&&s.setRequestHeader(item,t.headers[item]);s.onload=function(){200===s.status?o(JSON.parse(s.responseText)):r({error:new Error(s.responseText),status:s.status})},s.onerror=function(){console.log("Error",s),r(new Error("Network Error"))};var u=t.transformRequest||function(e){return n.isUndefined(e)?void 0:(console.log(e),JSON.stringify(e))};s.send(u(t.data))})},n.urlParameterByName=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),o=n.exec(t||location.search);return null===o?void 0:decodeURIComponent(o[1].replace(/\+/g," "))},n.forEach=function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(e[n],n);else for(var o in e)e.hasOwnProperty(o)&&t(e[o],o)},n.isStorageAvailable=function(){return null==o&&(o=void 0!==typeof Storage),o},n.writeSessionStorage=function(e,t){this.isStorageAvailable&&sessionStorage.setItem(e,t)},n.readSessionStorage=function(e){return this.isStorageAvailable?sessionStorage.getItem(e):void 0},n.removeSessionStorage=function(e){this.isStorageAvailable&&sessionStorage.removeItem(e)},n.formatString=function(e,t){for(var n=e,o=1;o<arguments.length;o++){var r=new RegExp("\\{"+(o-1)+"\\}","gm");n=n.replace(r,arguments[o])}return n}},{}],7:[function(e,t,n){function o(e){this.uid=e.UID,this.name=e.Name}o.prototype.getUID=function(){return this.uid},o.prototype.getName=function(){return this.name},t.exports=o},{}],8:[function(e,t,n){function o(e){this.uid=e.UID,this.url=e.URL,this.height=e.Height,this.width=e.Width}o.prototype.getUID=function(){return this.uid},o.prototype.getUrl=function(){return this.url},o.prototype.getHeight=function(){return this.height},o.prototype.getWidth=function(){return this.width},t.exports=o},{}],9:[function(e,t,n){function o(e){this.uid=e.UID,this.name=e.Name,this.description=e.Description,this.postalCode=e.Zipcode,this.city=e.City,this.street=e.Street,this.email=e.Email,this.phone=e.Phone,this.website=e.Homepage,this.facebook=e.Facebook,this.twitter=e.Twitter,this.checkInCount=e.Checkins,this.checkInCode=e.Checkin_Code,this.gpsLatitude=e.GPS_Latitude,this.gpsLongitude=e.GPS_Longitude}e("./image");o.prototype.getUID=function(){return this.uid},o.prototype.getName=function(){return this.name},o.prototype.getDescription=function(){return this.description},o.prototype.getPostalCode=function(){return this.postalCode},o.prototype.getCity=function(){return this.city},o.prototype.getStreet=function(){return this.street},o.prototype.getEmail=function(){return this.email},o.prototype.getPhone=function(){return this.phone},o.prototype.getWebsite=function(){return this.website},o.prototype.getFacebook=function(){return this.facebook},o.prototype.getTwitter=function(){return this.twitter},o.prototype.getCheckInCount=function(){return this.checkInCount},o.prototype.getPlaylistCount=function(){return this.playlistCount},o.prototype.getCheckInCode=function(){return this.checkInCode},o.prototype.getGPSLatitude=function(){return this.gpsLatitude},o.prototype.getGPSLongitude=function(){return this.gpsLongitude},t.exports=o},{"./image":8}],10:[function(e,t,n){function o(e,t){this.offsetIndex=e.OffsetIndex,this.offsetCount=e.OffsetCount,this.totalCount=e.Items,this.value=e.Value,this.valueFunc=t}var r=e("../utils");o.prototype.getOffsetIndex=function(){return this.offsetIndex},o.prototype.getOffsetCount=function(){return this.offsetCount},o.prototype.getTotalCount=function(){return this.totalCount},o.prototype.getValue=function(){return r.isDefined(this.valueFunc)?this.valueFunc(this.value):this.value},t.exports=o},{"../utils":6}],11:[function(e,t,n){function o(e){this.uid=e.UID,this.title=e.Name,this.artist=e.Artist,this.album=e.Album,this.duration=e.Duration,this.votes=e.Votes,this.playCount=e.Played,this.votable=e.Votable,this.genres=e.Genres,this.images=e.Images,this.user=e.User,this.addedAt=e.Added}var r=e("../utils"),i=e("./image"),s=e("./genre"),u=e("./user");o.prototype.getUID=function(){return this.uid},o.prototype.getTitle=function(){return this.title},o.prototype.getArtist=function(){return this.artist},o.prototype.getAlbum=function(){return this.album},o.prototype.getDuration=function(){return this.duration},o.prototype.getVoteCount=function(){return this.votes},o.prototype.getPlayCount=function(){return this.playCount},o.prototype.isVotable=function(){return this.votable},o.prototype.getImages=function(){var e=[];return r.forEach(this.images,function(t,n){e.push(new i(t))}),0==e.length&&null!=BTDJ.getDefaultCoverUrl()&&e.push(new i({URL:BTDJ.getDefaultCoverUrl()})),e},o.prototype.getGenres=function(){var e;return r.isArray(this.genres)?e=this.genres:(e=[],r.forEach(this.genres,function(t,n){e.push(new s(t))}),this.genres=e),e},o.prototype.getUser=function(){return new u(this.user)},o.prototype.getAddedAt=function(){return new Date(this.addedAt)},o.prototype.vote=function(e,t){return BTDJ.API.voteForTrack(this.uid,e,t)},o.prototype.addToLiveplaylist=function(e,t){return BTDJ.API.addTrackToLiveplaylist(this.uid,e,t)},t.exports=o},{"../utils":6,"./genre":7,"./image":8,"./user":12}],12:[function(e,t,n){function o(e){this.username=e.Username,this.image=(r.isDefined(e.Image)||null!=e.Image)&&e.Image.length>0?e.Image:BTDJ.getDefaultAvatarUrl()}var r=e("../utils");e("./location");o.prototype.getUsername=function(){return this.username},o.prototype.getImage=function(){return this.image},t.exports=o},{"../utils":6,"./location":9}]},{},[4])(4)});