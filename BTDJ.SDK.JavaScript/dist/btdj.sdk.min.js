!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.BTDJ=t()}}(function(){return function t(e,n,o){function i(s,u){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[s]={exports:{}};e[s][0].call(f.exports,function(t){var n=e[s][1][t];return i(n?n:t)},f,f.exports,t,e,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(t,e,n){var o=t("./api/oauth2"),i=t("./vars/offsetObject"),r=t("./vars/user"),s=t("./vars/track"),u=t("./vars/location"),a=t("./logger"),c=t("./utils");const f="https://res.btdj.de/",h="https://dev.res.btdj.de/",d="api/User",p="api/Liveplaylist",l="api/Location",g="/Get",m=15;n.OAuth2=o,n.getApiUrl=function(){return BTDJ.isDevMode()?h:f},n.getCurrentUser=function(){var t=this;return new Promise(function(e,n){var i={headers:o.getAuthorzationHeader()};c.XHR(t.getApiUrl()+d+g,i).then(function(t){e(new r(t))},n)})},n.getCurrentLocation=function(){var t=this;return new Promise(function(e,n){var i={headers:o.getAuthorzationHeader()};c.XHR(t.getApiUrl()+l+"/Checkin",i).then(function(t){e(new u(t.Location))},n)})},n.getLocation=function(){var t=this;return new Promise(function(e,n){var i={headers:o.getAuthorzationHeader()};c.XHR(t.getApiUrl()+l+g,i).then(function(t){e(new u(t))},n)})},n.getLocationWithGPS=function(t,e){var n=this;return new Promise(function(i,r){if(!navigator.geolocation)return void r(new Error("Geolocation is not supported by this browser."));var s={enableHighAccuracy:!0,maximumAge:6e4},f=!1,h=function(t){if(r(t),f=!0,c.isDefined(t.code))switch(t.code){case t.PERMISSION_DENIED:a.error("Geolocation: User denied the request for Geolocation.");break;case t.POSITION_UNAVAILABLE:a.error("Geolocation: Location information is unavailable.");break;case t.TIMEOUT:a.error("Geolocation: The request to get user location timed out.");break;default:a.error("An unknown error occurred.")}};window.setTimeout(function(){f||(a.log("Geolocation: Time out."),h(new Error("Geo Location timed out.")))},3e4),navigator.geolocation.getCurrentPosition(function(s){f=!0;var a={headers:o.getAuthorzationHeader(),params:{GPS_Lat:s.coords.latitude,GPS_Lon:s.coords.longitude,Radius:50,OffsetIndex:c.isDefined(t)?t:0,OffsetCount:c.isDefined(e)&&0!=e?e:m}};c.XHR(n.getApiUrl()+l+g,a).then(function(t){i(new u(t))},r)},h,s)})},n.getLiveplaylist=function(t,e){var n=this;return new Promise(function(r,u){var a={headers:o.getAuthorzationHeader(),params:{OffsetIndex:c.isDefined(t)?t:0,OffsetCount:c.isDefined(e)&&0!=e?e:m}};c.XHR(n.getApiUrl()+p+g,a).then(function(t){r(new i(t,function(t){var e=[];return c.forEach(t,function(t,n){e.push(new s(t))}),e}))},u)})},n.voteForTrack=function(t,e,n){var r,u=this;return r=c.isString(t)?t:t.getUID(),new Promise(function(t,a){var f={method:"POST",headers:o.getAuthorzationHeader(),params:{TrackUID:r,OffsetIndex:c.isDefined(e)?e:0,OffsetCount:c.isDefined(n)&&0!=n?n:m}};c.XHR(u.getApiUrl()+p+"/Vote",f).then(function(e){t(new i(e,function(t){var e=[];return c.forEach(t,function(t,n){e.push(new s(t))}),e}))},a)})},n.addTrackToLiveplaylist=function(t,e,n){var r,u=this;return r=c.isString(t)?t:t.getUID(),new Promise(function(t,a){var f={method:"PUT",headers:o.getAuthorzationHeader(),params:{TrackUID:r,OffsetIndex:c.isDefined(e)?e:0,OffsetCount:c.isDefined(n)&&0!=n?n:m}};c.XHR(u.getApiUrl()+p+"/AddTrack",f).then(function(e){t(new i(e,function(t){var e=[];return c.forEach(t,function(t,n){e.push(new s(t))}),e}))},a)})},n.searchTrack=function(t,e,n){var r=this;return new Promise(function(u,a){var f={headers:o.getAuthorzationHeader(),params:{Term:t,OffsetIndex:c.isDefined(e)?e:0,OffsetCount:c.isDefined(n)&&0!=n?n:m}};c.XHR(r.getApiUrl()+p+"/Search",f).then(function(t){u(new i(t,function(t){var e=[];return c.forEach(t,function(t,n){e.push(new s(t))}),e}))},a)})},n.searchLocation=function(t,e,n){var r=this;return new Promise(function(s,a){var f={headers:o.getAuthorzationHeader(),params:{Term:t,OffsetIndex:c.isDefined(e)?e:0,OffsetCount:c.isDefined(n)&&0!=n?n:m}};c.XHR(r.getApiUrl()+l+g,f).then(function(t){s(new i(t,function(t){var e=[];return c.forEach(t,function(t,n){e.push(new u(t))}),e}))},a)})},n.checkIn=function(t,e){var n,i=this;return n=c.isString(t)?t:t.getUID(),new Promise(function(t,r){var s={method:"POST",headers:o.getAuthorzationHeader(),params:{LocationUID:n,Code:e}};c.XHR(i.getApiUrl()+l+"/Checkin",s).then(function(e){t(new u(e.Location))},r)})},n.checkInWithCode=function(t){var e=this;return new Promise(function(n,i){var r={method:"POST",headers:o.getAuthorzationHeader(),params:{Code:t}};c.XHR(e.getApiUrl()+l+"/Checkin",r).then(function(t){n(new u(t.Location))},i)})}},{"./api/oauth2":3,"./logger":5,"./utils":6,"./vars/location":9,"./vars/offsetObject":10,"./vars/track":11,"./vars/user":12}],2:[function(t,e,n){function o(){return BTDJ.isDevMode()?c:a}function i(t){s.isUndefined(t.login)&&(t.login=f),this.client=BTDJ.API.OAuth2.getClient(),this.redirect=t.login.redirect,this.overStorage=t.login.overStorage,this.scopes=t.login.scopes,this.timeOut=t.login.timeOut,this.authUrl=r(this)}function r(t){return o()+"?scope="+t.scopes+"&client_id="+t.client.clientKey+"&response_type=code&redirect_uri="+(t.redirect||window.location.protocol+"//"+window.location.hostname)}var s=t("../utils"),u=t("../logger");const a="https://auth.cuco.lol/BTDJ/OAuth2/Authorize",c="https://dev.auth.cuco.lol/BTDJ/OAuth2/Authorize",f={overStorage:!0,timeOut:500,scopes:"user_private"};i.prototype.run=function(){var t=this,e=s.readSessionStorage("btdj.access.code"),n=!1,o=s.isDefined(s.urlParameterByName("code"));if(n||o){u.log("Get token.");var i;return o?i=s.urlParameterByName("code"):n&&(i=e),new Promise(function(t,e){s.isDefined(i)?(s.writeSessionStorage("btdj.access.code",i),t(i)):e()})}u.log("Code not found."),setTimeout(function(){window.location.href=t.authUrl},t.timeOut)},e.exports=i},{"../logger":5,"../utils":6}],3:[function(t,e,n){function o(){return BTDJ.isDevMode()?f:c}function i(t){u.isUndefined(t)&&a.error("the code is not defined.");var e={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{grant_type:"authorization_code",code:t,client_id:h.clientKey,client_secret:h.clientSecret,state:Math.abs(Math.random().toString().split("").reduce(function(t,e){return(t<<5)-t+e})).toString(36).substr(0,11),redirect_uri:window.location.protocol+"//"+window.location.hostname},transformRequest:function(t){var e=[];for(p in t)e.push(encodeURIComponent(p)+"="+encodeURIComponent(t[p]));return e.join("&")}};return new Promise(function(t,n){u.XHR(o(),e).then(function(e){u.writeSessionStorage("btdj.access.token",JSON.stringify(e)),d=new r(e),t()},n)})}function r(t){this.accessToken=t.access_token,this.refreshToken=t.refresh_token,this.tokenType=t.token_type}var s=t("./login"),u=t("../utils"),a=t("../logger");const c="https://auth.cuco.lol/BTDJ/OAuth2/Token",f="https://dev.auth.cuco.lol/BTDJ/OAuth2/Token";var h,d;n.refreshToken=function(){d.isDefined()||a.error("The data is undefined.");var t={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{grant_type:"refresh_token",refresh_token:d.getRefreshToken(),client_id:h.clientKey,client_secret:h.clientSecret},transformRequest:function(t){var e=[];for(p in t)e.push(encodeURIComponent(p)+"="+encodeURIComponent(t[p]));return e.join("&")}};return new Promise(function(e,n){u.XHR(o(),t).then(function(t){u.writeSessionStorage("btdj.access.token",JSON.stringify(t)),d=new r(t),e()},function(t){a.log("Error on get token: "+t),n(t)})})},n.setClient=function(t,e){h={clientKey:t,clientSecret:e},a.log("Client was set.")},n.getClient=function(){return h},n.getAccessToken=function(){return u.isDefined(d)?d.getToken():null},n.getAuthorzationHeader=function(){return{Authorization:d.getType()+" "+d.getToken()}},n.isAuthenticated=function(){return u.isDefined(d)},n.clear=function(){u.removeSessionStorage("btdj.access.token")},n.createLogin=function(t){var e={client:h,login:u.isDefined(t)?t:{scopes:"user_private"}};return new Promise(function(t,n){var o=u.readSessionStorage("btdj.access.token");if(u.isUndefined(o)||null==o){var c=new s(e);c.run().then(function(e){a.log("Login was successfully. Code was received."),i(e).then(function(){u.removeSessionStorage("btdj.access.code"),t()},n)},function(t){a.log("Login failed. "+t),n()}),a.log("Login was created.")}else d=new r(JSON.parse(o)),t(),a.log("Token was found.")})},r.prototype.getToken=function(){return this.accessToken},r.prototype.getRefreshToken=function(){return this.refreshToken},r.prototype.getType=function(){return this.tokenType},r.prototype.isDefined=function(){return u.isDefined(this.accessToken)&u.isDefined(this.refreshToken)}},{"../logger":5,"../utils":6,"./login":2}],4:[function(t,e,n){var o=t("./api");t("./api/login"),t("./utils");const i={devMode:!1,autoLogin:!1,defaultCoverUrl:null,defaultAvatarUrl:null};n.API=o,n.init=function(t){return this.options=t||i,o.OAuth2.setClient(t.clientKey,t.clientSecret),t.autoLogin?o.OAuth2.createLogin(t.login):new Promise(function(t,e){t()})},n.isDevMode=function(){return this.options.devMode},n.getDefaultCoverUrl=function(){return this.options.defaultCoverUrl},n.getDefaultAvatarUrl=function(){return this.options.defaultAvatarUrl},n.OffsetObject=t("./vars/offsetObject"),n.Track=t("./vars/track")},{"./api":1,"./api/login":2,"./utils":6,"./vars/offsetObject":10,"./vars/track":11}],5:[function(t,e,n){n.error=function(t){throw new Error(t)},n.log=function(t){BTDJ.isDevMode()&&console.log("[ "+(new Date).toUTCString()+" ] "+t)}},{}],6:[function(t,e,n){var o;n.isDefined=function(t){return"undefined"!=typeof t},n.isUndefined=function(t){return"undefined"==typeof t},n.isString=function(t){return"string"==typeof t},n.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},n.XHR=function(t,e){var n=this;return n.isUndefined(e)&&(e={}),new Promise(function(o,i){if(n.isDefined(e.params)){var r="";for(item in e.params)e.params.hasOwnProperty(item)&&n.isDefined(item)&&(""!=r&&(r+="&"),r+=item+"="+e.params[item]);-1==t.indexOf("?")&&(r="?"+r),t+=r}var s=new XMLHttpRequest;if(s.open(e.method||"GET",t),n.isDefined(e.headers))for(item in e.headers)e.headers.hasOwnProperty(item)&&n.isDefined(item)&&s.setRequestHeader(item,e.headers[item]);s.onload=function(){200===s.status?o(JSON.parse(s.responseText)):i({error:new Error(s.responseText),status:s.status})},s.onerror=function(){console.log("Error",s),i(new Error("Network Error"))};var u=e.transformRequest||function(t){return n.isUndefined(t)?void 0:(console.log(t),JSON.stringify(t))};s.send(u(e.data))})},n.urlParameterByName=function(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)"),o=n.exec(e||location.search);return null===o?void 0:decodeURIComponent(o[1].replace(/\+/g," "))},n.forEach=function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;n++)e(t[n],n);else for(var o in t)t.hasOwnProperty(o)&&e(t[o],o)},n.isStorageAvailable=function(){return null==o&&(o=void 0!==typeof Storage),o},n.writeSessionStorage=function(t,e){this.isStorageAvailable&&sessionStorage.setItem(t,e)},n.readSessionStorage=function(t){return this.isStorageAvailable?sessionStorage.getItem(t):void 0},n.removeSessionStorage=function(t){this.isStorageAvailable&&sessionStorage.removeItem(t)},n.formatString=function(t,e){for(var n=t,o=1;o<arguments.length;o++){var i=new RegExp("\\{"+(o-1)+"\\}","gm");n=n.replace(i,arguments[o])}return n}},{}],7:[function(t,e,n){function o(t){this.uid=t.UID,this.name=t.Name}o.prototype.getUID=function(){return this.uid},o.prototype.getName=function(){return this.name},e.exports=o},{}],8:[function(t,e,n){function o(t){this.uid=t.UID,this.url=t.URL,this.height=t.Height,this.width=t.Width}o.prototype.getUID=function(){return this.uid},o.prototype.getUrl=function(){return this.url},o.prototype.getHeight=function(){return this.height},o.prototype.getWidth=function(){return this.width},e.exports=o},{}],9:[function(t,e,n){function o(t){this.uid=t.UID,this.name=t.Name,this.description=t.Description,this.postalCode=t.Zipcode,this.city=t.City,this.street=t.Street,this.email=t.Email,this.phone=t.Phone,this.website=t.Homepage,this.facebook=t.Facebook,this.twitter=t.Twitter,this.image=t.Image,this.imageBig=t.Image_Big,this.checkInCount=t.Checkins,this.playlistCount=t.Playlist_Count,this.checkInCode=t.Checkin_Code,this.gpsLatitude=t.GPS_Latitude,this.gpsLongitude=t.GPS_Longitude}var i=t("./image");o.prototype.getUID=function(){return this.uid},o.prototype.getName=function(){return this.name},o.prototype.getDescription=function(){return this.description},o.prototype.getPostalCode=function(){return this.postalCode},o.prototype.getCity=function(){return this.city},o.prototype.getStreet=function(){return this.street},o.prototype.getEmail=function(){return this.email},o.prototype.getPhone=function(){return this.phone},o.prototype.getWebsite=function(){return this.website},o.prototype.getFacebook=function(){return this.facebook},o.prototype.getTwitter=function(){return this.twitter},o.prototype.getImage=function(){return new i(this.image)},o.prototype.getImageBig=function(){return new i(this.imageBig)},o.prototype.getCheckInCount=function(){return this.checkInCount},o.prototype.getPlaylistCount=function(){return this.playlistCount},o.prototype.getCheckInCode=function(){return this.checkInCode},o.prototype.getGPSLatitude=function(){return this.gpsLatitude},o.prototype.getGPSLongitude=function(){return this.gpsLongitude},e.exports=o},{"./image":8}],10:[function(t,e,n){function o(t,e){this.offsetIndex=t.OffsetIndex,this.offsetCount=t.OffsetCount,this.totalCount=t.Items,this.value=t.Value,this.valueFunc=e}var i=t("../utils");o.prototype.getOffsetIndex=function(){return this.offsetIndex},o.prototype.getOffsetCount=function(){return this.offsetCount},o.prototype.getTotalCount=function(){return this.totalCount},o.prototype.getValue=function(){return i.isDefined(this.valueFunc)?this.valueFunc(this.value):this.value},e.exports=o},{"../utils":6}],11:[function(t,e,n){function o(t){this.uid=t.UID,this.title=t.Name,this.artist=t.Artist,this.album=t.Album,this.duration=t.Duration,this.votes=t.Votes,this.playCount=t.Played,this.votable=t.Votable,this.genres=t.Genres,this.images=t.Images,this.user=t.User,this.addedAt=t.Added}var i=t("../utils"),r=t("./image"),s=t("./genre"),u=t("./user");o.prototype.getUID=function(){return this.uid},o.prototype.getTitle=function(){return this.title},o.prototype.getArtist=function(){return this.artist},o.prototype.getAlbum=function(){return this.album},o.prototype.getDuration=function(){return this.duration},o.prototype.getVoteCount=function(){return this.votes},o.prototype.getPlayCount=function(){return this.playCount},o.prototype.isVotable=function(){return this.votable},o.prototype.getImages=function(){var t=[];return i.forEach(this.images,function(e,n){t.push(new r(e))}),0==t.length&&null!=BTDJ.getDefaultCoverUrl()&&t.push(new r({URL:BTDJ.getDefaultCoverUrl()})),t},o.prototype.getGenres=function(){var t;return i.isArray(this.genres)?t=this.genres:(t=[],i.forEach(this.genres,function(e,n){t.push(new s(e))}),this.genres=t),t},o.prototype.getUser=function(){return new u(this.user)},o.prototype.getAddedAt=function(){return new Date(this.addedAt)},o.prototype.vote=function(t,e){return BTDJ.API.voteForTrack(this.uid,t,e)},o.prototype.addToLiveplaylist=function(t,e){return BTDJ.API.addTrackToLiveplaylist(this.uid,t,e)},e.exports=o},{"../utils":6,"./genre":7,"./image":8,"./user":12}],12:[function(t,e,n){function o(t){this.username=t.Username,this.firstName=t.Firstname,this.lastName=t.Lastname,this.city=t.City,this.email=t.Email,this.image=(i.isDefined(t.Image)||null!=t.Image)&&t.Image.length>0?t.Image:BTDJ.getDefaultAvatarUrl(),this.location=t.Location}var i=t("../utils"),r=t("./location");o.prototype.getUsername=function(){return this.username},o.prototype.getFirstName=function(){return this.firstName},o.prototype.getLastName=function(){return this.lastName},o.prototype.getFullName=function(t){var e=i.isDefined(t)?t:"{0} {1}";return i.formatString(e,this.firstName,this.lastName)},o.prototype.getCity=function(){return this.city},o.prototype.getEmail=function(){return this.email},o.prototype.getImage=function(){return this.image},o.prototype.getLocation=function(){return new r(this.location)},e.exports=o},{"../utils":6,"./location":9}]},{},[4])(4)});